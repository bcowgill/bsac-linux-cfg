const alphabet_url = 'https://www.youtube.com/watch?v=C_dbN9N0pR4'
const phrase_url = 'https://www.youtube.com/watch?v=nKgveRTPWd8'
const word_url = 'https://www.youtube.com/watch?v=Iz3h3B5jBz8'

const vowels = 'AEIOU'.split('')
const consonants = 'BCDFGHJKLMNPQRSTVWXYZ'.split('')
const alphabet = [...vowels, ...consonants]
const natural = [
	'bored',
	'boring',
	'delighted',
	'weird',
	'strange',
	'call/phone me',
	'telephone',
	'drink?',
	'eat?',
	'smoke?',
	'hi',
	'goodbye',
	'baby',
	'swim',
	'drive',
	'car',
	'book',
	'can',
	'aunt',
	'yes',
	'no',
	'not me!',
	'No that\'s wrong!',
	'Don\'t know',
	'happy',
	'I\'m not happy',
	'Floor',
	'Wall',
	'Door',
	'Moving car',
	'Facing you',
	'Moving away',
	'Approaching you',
	'stand',
	'walk',
	'jump',
	'hop',
	'sit',
	'fall',
	'kneel',
	'watch',
	'look',
	'look up',
	'look down',
	'stare',
	'chilly',
	'cold',
	'freezing',
	'gentle breeze',
	'strong wind',
	'gale',
]
const spelling = "abra:abut:acrid:acu:adad:adde:adel:ado:ados:aes:agar:agas:ages:agir:agni:aider:aim:air:airt:airts:ajar:alan:allen:allo:alma:alot:amahs:amene:amir:amis:amla:amor:anal:anan:anas:anasa:and:anes:anger:anon:ante:anu:apart:ape:apod:arab:arak:arar:aras:arb:arba:arbas:are:ares:aret:aril:aryl:asana:assam:asses:ate:ati:atok:auks:aus:aut:aval:ave:avid:avis:avo:avon:ayr:bad:bag:bal:bam:ban:bans:bara:bard:bark:bas:bat:bats:bed:beg:ben:bens:bid:big:bin:bins:bird:bis:blub:bobac:boc:bod:bog:boh:bok:bon:bonk:bor:bos:bots:bows:boy:bra:brag:bro:bros:bud:buf:bulb:bun:bunk:buns:bur:burd:burg:bus:but:buts:cabob:caf:cal:cam:camus:cap:cares:cas:cen:cep:ceps:cfr:cire:cires:cit:cito:cob:cod:codem:col:cor:corp:cos:cpu:cram:cran:craps:css:cur:dab:dace:dada:dag:dah:dahs:dal:dam:damon:dap:daraf:dard:darg:dart:darts:das:dat:daud:daw:daws:deb:debut:decaf:decal:dedal:dedit:deem:deep:deeps:deer:dees:def:deid:deil:del:delf:delis:dels:dem:deman:demel:demit:den:denim:dens:depot:der:des:deus:devas:devil:dew:deys:dial:dib:died:dig:dim:din:dir:dirca:dirts:dit:div:diva:dna:dob:doc:dog:doh:dohs:dom:don:dons:doom:door:dop:dopa:dor:dorp:dorps:dort:dos:dot:doug:drab:drad:drail:drap:draw:draws:dray:drey:drib:drool:drow:drows:drub:dsl:dts:duad:dual:dub:dull:dum:dup:ean:eas:eat:eaus:ecad:edam:edda:edile:edit:eel:eels:een:eer:ehs:elide:eliot:emir:emit:emits:emong:enema:enim:epa:era:eram:erat:erg:ergo:eric:erics:eris:erit:eros:erp:esnes:eta:etas:etat:eten:eth:etna:etnas:euges:eur:eva:eval:even:evets:evil:evils:exul:fac:faced:farad:fed:feel:feer:fen:fer:fet:fies:fig:fires:fled:flog:flow:foo:fool:fro:fub:gab:gad:gal:gals:gam:gan:gar:garb:gas:gat:gats:geb:gel:gem:get:gib:gid:gif:gins:gip:girt:girts:gis:git:gnar:gnat:gnats:gnaw:gnaws:gnome:gnus:gob:god:golf:gorp:gorps:gos:got:grad:gram:gre:grub:gsm:gulp:gum:gums:guns:guod:gup:gur:gut:guv:guy:had:hahs:hales:hap:hay:her:hey:hob:hod:hon:hoo:hoop:hop:hos:hte:ibis:ido:ies:inga:ingo:ios:iris:iron:irs:isp:ita:itas:jar:kam:kara:kay:keas:keel:keels:keep:ken:keps:kips:kirks:kiths:knaps:knar:knit:knits:knob:knot:knots:knub:knuts:kob:kota:krab:krans:lab:lac:laced:lad:laded:laer:lag:lager:laid:lair:lais:lam:lana:lap:lares:larum:larus:las:laud:lav:lava:lave:law:leat:leats:leben:led:leda:lee:leef:leek:leeks:leep:leeps:leer:lees:leet:leets:leg:leir:lem:lemed:lemes:leon:leper:les:let:lev:lever:lez:liar:liard:lied:lien:lies:lin:lion:lira:lit:live:lived:llud:lobo:loc:loges:loof:loom:loons:loop:loops:loord:loos:loot:loots:lop:los:lsd:luxe:lyra:mab:mac:macs:mad:made:mag:mak:mal:man:map:maps:mar:marc:marcs:mare:marg:mart:mas:massa:mat:maws:may:med:medoc:meed:meet:meets:meg:mel:men:mer:met:meter:mew:mho:mia:mid:milo:mils:min:mine:mined:mir:mis:mit:mod:mon:moo:mood:mool:mools:moops:moor:moot:mop:mor:morts:mot:msg:mud:mug:mulet:mural:mures:mus:mut:muton:nab:nae:nag:nala:nam:named:namer:nana:nap:naps:narc:narcs:nas:nat:nats:nav:neb:nebel:nec:ned:nee:neep:neer:nef:neil:nek:nella:nem:nemo:nep:net:nete:nets:neve:neves:new:nib:nid:nil:nim:nip:nips:nis:nit:nob:nod:noel:noh:noil:nom:nomad:nona:nonet:noop:noops:nor:nori:nos:not:notes:notum:nov:nova:now:noy:nub:nur:nut:nuts:oar:oat:obol:oda:oder:odi:oes:offer:ogni:ogre:ohm:ohos:olim:olla:omen:oner:oof:ooh:oohs:oom:orb:orf:otic:ottos:ous:ova:owt:pac:pacer:pad:pah:pal:palp:pals:pam:pan:pans:par:pard:part:parts:pas:pat:pats:paw:paws:pay:pct:pec:peed:peek:peel:peels:peen:pees:pen:per:perts:pets:pig:pin:pins:pis:pit:plap:plug:pod:poh:pohs:pol:pols:pom:pooh:pool:pools:poon:poons:poor:poort:poots:port:ports:pos:posys:pot:pots:pow:pows:prat:pre:proc:prod:prog:psi:pud:pug:puris:pus:put:puy:rag:raga:rages:rahs:rail:rait:raj:raja:rales:ram:ramis:rang:rank:rao:rap:raps:rara:ras:rast:rat:rats:raw:real:reaps:rebit:rebus:rebut:recap:red:redes:redia:redo:ree:reed:reef:reeks:reel:reels:reen:reens:rees:ref:reffo:regal:regna:reh:relit:rem:reman:remit:remus:reno:rep:repel:repot:res:ret:retem:rev:revel:rfc:ria:rial:rias:rid:riel:riga:rim:rima:rime:rims:rimy:rits:rob:roc:rod:roes:rom:roma:ron:rones:rood:room:roop:roops:roots:rot:rub:ruc:rucs:rue:rug:rums:run:rus:rya:sab:sabra:sac:sad:sae:saek:sag:saga:sair:sakis:sal:sam:san:sana:sante:sap:saps:sar:sara:saros:sarus:sat:sate:sati:saved:saw:scam:scire:scram:scran:scur:sea:seals:sed:seder:seed:seel:seems:seep:seer:sega:segar:segol:segue:sei:seif:seil:sekos:sel:selah:selar:semel:sena:senor:sense:seo:seor:seps:ser:sera:serac:seral:seric:serif:seris:serum:sesey:sessa:set:seton:seven:sey:seys:shad:shah:shama:shar:shay:she:shod:shoo:shop:shtik:sial:sib:sibi:sig:sikas:siled:sim:sima:simar:sin:sip:sire:sires:siri:sirup:sit:siva:skeel:skeer:skips:skrik:skua:slaes:slag:slap:sled:slee:sleek:sleep:sleer:sleet:slim:slit:slive:sloom:sloop:sloot:slop:smart:smees:smew:smir:smoot:smug:smur:smut:smuts:snab:snap:snaps:snark:sneb:sned:sneer:snib:snig:snip:snips:snirt:snit:snod:snool:snoop:snoot:snort:snot:snow:snub:snug:sob:soc:sod:soda:sog:soh:soho:soi:sokes:sol:son:sool:sop:soras:sorb:sore:sotto:sous:sov:sow:soy:spaer:spam:span:spank:spans:spar:sparc:spart:spas:spat:spats:spay:spec:speed:speel:spek:spes:spik:spiks:spin:spins:spirt:spit:spool:spoom:spoon:spoor:spot:spots:sprat:sprod:sprog:sri:ssc:stab:stael:stag:stan:stang:stap:staps:star:start:stat:staw:staws:std:steel:steem:sten:step:steve:stew:stime:stink:stir:stob:stonk:stool:stoop:stoor:stop:stops:stot:stow:stows:strad:strap:straw:strep:stria:strid:strig:strom:strop:strow:stub:stums:stun:stunk:sua:suae:sub:suber:sued:sum:sumac:sumer:sung:suo:suos:sup:sur:sural:suras:swad:swam:swang:swap:sward:swat:swats:sway:swob:swop:sword:swot:swots:syed:syes:syrt:sysop:tab:tad:tae:tael:tag:tam:tan:tang:tao:tap:taps:tar:tare:tarp:tarps:tart:tas:tate:tats:taw:taws:tcp:teel:teels:teem:tef:teg:tel:telum:tem:ten:tenon:ter:tera:tes:tew:tiar:tiber:tic:tid:tide:tided:tig:til:tiler:tils:tim:time:timed:timer:tin:tink:tins:tip:tips:tire:tis:tod:tog:toile:tola:tom:ton:tonk:tons:tool:tools:toom:tooms:toons:top:toped:toper:tops:tor:tort:tots:tow:tows:trad:tram:trams:trap:trapa:traps:trat:trats:tria:trig:trins:trips:trod:trons:troop:trop:trot:trow:trys:tsar:tua:tub:tuba:tubed:tuber:tug:tum:tums:tun:tup:two:uca:una:upc:val:van:vel:ver:vid:von:vos:vug:wad:wal:wang:wap:war:ward:warts:was:wat:wats:way:wed:wem:wems:wen:wet:wets:wey:wolf:won:wons:wop:word:wort:worts:wos:wot:wots:yah:yahs:yak:yam:yap:yaps:yard:yaw:yaws:yeh:yerd:yes:yeses:yew:ymir:yob:yon:yos:yug:yup:zel".split(/:/g);

const words = [
	'hello',
	'bye',
	'good',
	'thanks',
	'please',
	'name',
	'me',
]
const out_of_it = "I'm staying out of it"
const phrases = [
	'Let me know',
	'Let you know',
	'Let you all know',
	'Sorry, my mind has gone blank!',
	"I don't mind",
	'Have to put up with it',
	"That's interesting",
	'Not yet',
	'Take my time',
	out_of_it,
	'Again, please',
	'Way over my head!',
	'See you later',
	'See you tomorrow',
	'See you tonight',
	'Good morning',
	'Good afternoon',
	'Good evening',
	'Good night',
	'Thank you',
]

const drills = {
	vowels, consonants, alphabet, spelling, natural, words, phrases
}
const descriptions = {
	spelling: 'Finger spelling drills',
	natural: 'BSL for DUMMIES ch2',
}
const urls = {
	vowels: alphabet_url,
	consonants: alphabet_url,
	alphabet: alphabet_url,
	words: word_url,
	phrases: phrase_url,
}

const rates = {
	snail: 9,
	slow: 5,
	fast: 3,
	rapid: 2,
	speedy: 1,
	devilish: 0.5,
}

const sec = 1000
const smaller = 'card smaller2'
const smallest = 'card smaller3'

const title = document.getElementById('drill-title')
const desc = document.getElementById('description')
const link = document.getElementById('link')
const app = document.getElementById('controls')
const drillSelector = document.getElementById('drill-selector')
const speedSelector = document.getElementById('speed-selector')
const customList = document.getElementById('phrase-list')
const card = document.getElementById('flash-card')
const saveMessage = document.getElementById('save-state')

function randomWeight(item) {
	return {
		item, weight: Math.random()
	}
}

function byWeight(less, more) {
	const order = less.weight === more.weight ? 0 : less.weight < more.weight ? -1 : 1
	return order
}

function toItems(weighted) {
	return weighted.item
}

function stripBlanks(phrase) {
	return phrase.trim().length > 0
}

function trace(item) {
	console.log('item', item)
	return item
}

let noSave = true
function getState() {
	if ('localStorage' in window) {
		try {
			customList.value = localStorage.getItem("customList") ?? ''
			noSave = false
		}
		catch (exception) {
		}
	}
}

function saveState(content) {
	if ('localStorage' in window) {
		try {
			localStorage.setItem("customList", content)
		}
		catch (exception) {
			noSave = true
		}
	}
}

function updateSaveState(disabled) {
	saveMessage.innerText = disabled ? '(cannot save)' : '(saved automatically)'
}

let timer;

function startDrill() {
	if (timer) {
		clearInterval(timer)
		timer = void 0
	}

	const drill = drillSelector.value ?? 'Phrases'
	const speed = speedSelector.value ?? 'Rapid'
	const custom = customList.value ?? ''

	//console.log('settings', drill, speed)

	updateSaveState(noSave)
	if (drill === 'Custom') {
		drills.custom = custom.split("\n").filter(stripBlanks)
		if (drills.custom.length < 1) {
			drills.custom = void 0
		}
	}
	const items = drills[drill.toLowerCase()] ?? drills.alphabet
	const url = urls[drill.toLowerCase()]
	const description = descriptions[drill.toLowerCase()] ?? (url ? 'See video' : '')

	const showTime = sec * (rates[speed.toLowerCase()] ?? rates.slow)
	const hideTime = sec * speed === 'speedy' ? 0 : 1
	const styled = /^(vowels|consonants|alphabet)$/i.test(drill) ? 'card' : 'card smaller'

	let cards = []

	title.innerText = 'Language Drill - ' + drill + ' - ' + speed
	if (url) {
		desc.innerText = ''
		link.innerText = description
		link.href = url
	}
	else {
		desc.innerText = description
		link.innerText = ''
		link.href = '#'
	}
	card.className = 'card smaller'
	card.innerText = 'Get ready...'

	timer = setInterval(function () {
		if (cards.length <= 0) {
			cards = items.map(randomWeight).sort(byWeight).map(toItems)
		}
		card.innerText = ''
		card.className = styled
		const next = cards[cards.length - 1].length
		if (next > 2 * out_of_it.length) {
			card.className = smallest
		}
		else if (next > out_of_it.length) {
			card.className = smaller
		}

		const drillNow = drillSelector.value ?? 'Phrases'
		const speedNow = speedSelector.value ?? 'Rapid'
		const customNow = customList.value ?? ''
		if ( drill !== drillNow || speed !== speedNow || custom !== customNow) {
			saveState(customNow)
			startDrill()
		}

		setTimeout(function () {
			card.innerText = cards[cards.length - 1]
			cards.pop()
		}, hideTime)
	}, showTime + hideTime)
}

function main() {
	// Show initially hidden app section
	app.className = ''
	getState()
	startDrill()
}

main()
